DATA_LENGTH = 8

DEFAULT_REQ_CAN_ID = 0x7F0
DEFAULT_RES_CAN_ID = 0x7F1

MSB = lambda ele: ele % 256
LSB = lambda ele: int(ele / 256)

# --####################################### Bootloader ########################################

# START_ADDRESS = 0x2000
# START_ADDRESS = 0x2400
# START_ADDRESS = 0x2800

START_ADDRESS = 0x3C00
END_ADDRESS = 0xFFFFFF

# BIN_FILE_PADDING_SIZE = 128
BIN_FILE_PADDING_SIZE = 36

HEX_CHUNK_SIZE = 252

L3 = {
    "constant": "0x2EDC6F82",
    # "constant": "0x2EDC6F45",
    "divisor_slice": (23, 22),
    "empty_fill_slice": (1, 0),
    "seed_pivot_slice": (31, 30),
    "lconst_pivot_slice": (15, 14)
}

L5 = {
    # "constant" : "0x841B8CDB",
    "constant": "0x841B8CEC",
    "divisor_slice": (9, 8),
    "empty_fill_slice": (9,8),
    "seed_pivot_slice": (27, 26),
    "lconst_pivot_slice": (4, 3),
}

# ****************************** Pre-Programming ****************************** #

BIN_DATA_FIRST_BYTE = 0x36

DEFAULT_FLASH_RESPONSE = [0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]

INIT_BATCH_1 = [0x02, 0x10, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00]
INIT_BATCH_2 = [0x02, 0x85, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00]
INIT_BATCH_3 = [0x03, 0x28, 0x83, 0x03, 0x00, 0x00, 0x00, 0x00]
# INIT_BATCH_4 = [0x02, 0x10, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00]
INIT_BATCH_4 = [0x02, 0x10, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00]
INIT_BATCH_5 = [0x02, 0x27, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00] # Seed Request
INIT_BATCH_6 = [0x06, 0x27, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00]

INIT_ERASE_REQ = [
    [0x10, 0x0C, 0x31, 0x01, 0xff, 0x00, 0x00, 0x00],
    [0x21, 0x3C, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00],
]
INIT_ERASE_REQ_ACK = [0x05, 0x71, 0x01, 0xff, 0x00, 0x01, 0x00, 0x00]

INIT_REQUEST_DOWNLOAD = [
    [0x10, 0x0B, 0x34, 0x00, 0x44, 0x00, 0x00, 0x3C],
    [0x21, 0x00, 0x00,  0x00, 0xC0, 0x00, 0x00, 0x00],
]

INIT_BATCH_8 = [0x04, 0x31, 0x03, 0xff, 0x00, 0x00, 0x00, 0x00]

INIT_BATCH_10 = [0x03, 0x34, 0x00, 0x33, 0x00, 0x00, 0x00, 0x00]

# INIT_BATCH_1_ACK = [0x06,  0x50, 0x03, 0x20, 0x00, 0x20, 0x00, 0x00]
INIT_BATCH_1_ACK = [0x06,  0x50, 0x03, 0x07, 0xD0, 0x13, 0x88, 0x00]
INIT_BATCH_2_ACK = [0x02, 0xC5, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00]
INIT_BATCH_3_ACK = [0x03, 0x68, 0x83, 0x03, 0x00, 0x00, 0x00, 0x00]
# INIT_BATCH_4_ACK = [0x06, 0x50, 0x02, 0x20, 0x00, 0x20, 0x00, 0x00]
INIT_BATCH_4_ACK = [0x06, 0x50, 0x02, 0x07, 0xD0, 0x13, 0x88, 0x00]
INIT_BATCH_5_ACK = [0x06, 0x67, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00]
INIT_BATCH_6_ACK = [0x02, 0x67, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00]
INIT_BATCH_8_ACK = [0x06, 0x71, 0x03, 0xff, 0x00, 0x01, 0x00, 0x00]
INIT_BATCH_10_ACK = [0x04, 0x74, 0x20, 0x00, 0xfe, 0x00, 0x00, 0x00]

# INIT_BATCH_ACK_LIST = [INIT_BATCH_1_ACK, INIT_BATCH_2_ACK, INIT_BATCH_3_ACK, INIT_BATCH_4_ACK, INIT_BATCH_5_ACK,
#                         INIT_BATCH_6_ACK,  INIT_BATCH_10_ACK]

INIT_BATCH_ACK_LIST = [INIT_BATCH_1_ACK, INIT_BATCH_4_ACK, INIT_BATCH_5_ACK,
                        INIT_BATCH_6_ACK,  INIT_BATCH_10_ACK]

HEX_CHUNK_END_ACK = [0x1, 0x76, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]

EOF_CHUNK_DATA = [0x01, 0x37, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
EOF_CHUNK_DATA_ACK = [0x01, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]

CHECK_SUM_REQUEST = [
    # [0x10, 0x0C, 0x31, 0x01, 0x02, 0x01, 0x00, 0x00],
    [0x10, 0x0E, 0x31, 0x01, 0x02, 0x01, 0x00, 0x00],
    [0x21, 0x3C, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00],
    [0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
]
# CHECK_SUM_RESPONSE = [0x04, 0x71, 0x01, 0x02, 0x01, 0x0, 0x00, 0x00]
CHECK_SUM_RESPONSE = [0x05, 0x71, 0x01, 0x02, 0x01, 0x01, 0x00, 0x00]

CHECK_VALIDATION_REQUEST = [0x04, 0x31, 0x03, 0x02, 0x01, 0x00, 0x00, 0x00]
# CHECK_VALIDATION_RESPONSE = [0x05, 0x71, 0x03, 0x02, 0x01, 0x01, 0x00, 0x00]
CHECK_VALIDATION_RESPONSE = [0x06, 0x71, 0x03, 0x02, 0x01, 0x01, 0x00, 0x00]

ECU_HARD_RESET_REQUEST = [0x02, 0x11, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00]
ECU_HARD_RESET_RESPONSE = [0x02, 0x51, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00]

L3_SEED_REQUEST = [0x02, 0x27, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00]
L3_KEY_REQUEST = [0x06, 0x27, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00]
L3_SEED_FROM_ECU = [0x06, 0x67, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00]
L3_KEY_POSITIVE_RESPONSE = [0x02, 0x67, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00]

CONTROL_FLOW_TAG = list(range(0x21, 0x2f)) + [0x2f, 0x20]

POST_PGM_MSG = [
                    [0x03, 0x28, 0x80, 0x03, 0x00, 0x00, 0x00, 0x00], # DELAY
                    [0x02, 0x85, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00],
                    [0x02, 0x10, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00],
                ]

POST_PGM_MSG_ACK = [
                    [0x03, 0x28, 0x80, 0x03, 0x00, 0x00, 0x00, 0x00], # DELAY
                    [0x02, 0xC5, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00],
                    [0x02, 0x50, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00],
                ]

# Bin Flash
BIN_FLASH_START = [0x10, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
BIN_FLASH_START_ACK = [0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]

SEED_KEY_NEG_RES = [127, 39, 53, 0, 0, 0, 0, 0]

# --####################################### Bootloader ########################################


# --####################################### Online Data ########################################
LIVE_DATA_CAN_ID = 0x701
# --####################################### Online Data ########################################

# --####################################### DID ########################################

DID_WRITE_REQ_FIRST_BYTE = 0x2E
DID_WRITE_RES_FIRST_BYTE = 0x6E

DID_READ_REQ_FIRST_BYTE = 0x22
DID_READ_RES_FIRST_BYTE = 0x62
DID_READ_SINGLE_RES_FIRST_BYTE = 0x6E

DID_RES_ASS_PART_NO = []

DID_WRITE_RESPONSE = [0x30, 0, 0, 0, 0, 0, 0, 0]
DID_RESPONSE = [0x30, 0, 0, 0, 0, 0, 0, 0]

DID_MSG_FIRST_BYTES = [0x21, 0x22, 0x22]

did_dict = {
    "did_ass_part_no": {
            "id" : 0,
            "text": "Assembly Part No",
            "did_req": [[0x10, 0x0B, 0x2E, 0xF1, 0x87], [0x21, ]],
            "did_res": [0x03, 0x6E, 0xF1, 0x87, 0, 0, 0, 0],
            "did_read_req": [0x03, 0x22, 0xF1, 0x87, 0, 0, 0, 0],
            "did_read_res": [0x10, 0x0B, 0x62, 0xF1, 0x87],
            "data_length": 8,
    },
    "did_hw_serial_no": {
            "id": 1,
            "text": "HW Serial No",
            "did_req": [[0x10, 0x0B, 0x2E, 0xF1, 0x8C], [0x21, ]],
            "did_res": [0x03, 0x6E, 0xF1, 0x8C, 0, 0, 0, 0],
            "did_read_req": [0x03, 0x22, 0xF1, 0x8C, 0, 0, 0, 0],
            "did_read_res": [0x10, 0x0B, 0x62, 0xF1, 0x8C],
            "data_length": 8,
    },
    "did_boot_con_version": {
        "id": 2,
        "text": "Bootloader Consolidated Version",
        "did_index": 0xF180,
        "did_req": [[0x10, 0x0B, 0x2E, 0xF1, 0x80], [0x21, ]],
        "did_res": [0x03, 0x6E, 0xF1, 0x80, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x80, 0, 0, 0, 0],
        "did_read_res": [0x10, 0x0B, 0x62, 0xF1, 0x80],
        "data_length": 8,
    },
    "did_vehicle_id": {
        "id": 3,
        "text": "Vehicle Identification No",
        "did_index": 0xF190,
        "did_req": [[0x10, 0x014, 0x2E, 0xF1, 0x90], [0x21,],[0x22,]],
        "did_res": [0x03, 0x6E, 0xF1, 0x90, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x90, 0, 0, 0, 0],
        "did_read_res": [0x10, 0x14, 0x62, 0xF1, 0x90],
        "data_length": 17,
    },
    "did_sw_part_no": {
        "id": 4,
        "text": "Software Part No",
        "did_index": 0xF181,
        "did_req": [[0x10, 0x0B, 0x2E, 0xF1, 0x81], [0x21, ]],
        "did_res": [0x03, 0x6E, 0xF1, 0x81, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x81, 0, 0, 0, 0],
        "did_read_res": [0x10, 0x0B, 0x62, 0xF1, 0x81],
        "data_length": 8,
    },
    "did_app_con_version": {
        "id": 5,
        "text": "Application Consolidated Version",
        "did_index": 0xF182,
        "did_req": [[0x10, 0x0B, 0x2E, 0xF1, 0x82], [0x21, ]],
        "did_res": [0x03, 0x6E, 0xF1, 0x82, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x82, 0, 0, 0, 0],
        "did_read_res": [0x10, 0x0B, 0x62, 0xF1, 0x82],
        "data_length": 8,
    },
    "did_app_date_of_update": {
        "id": 6,
        "text": "Application Date of Update",
        "did_index": 0xF199,
        "did_req": [[0x10, 0x0B, 0x2E, 0xF1, 0x99], [0x21, ]],
        "did_res": [0x03, 0x6E, 0xF1, 0x99, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x99, 0, 0, 0, 0],
        "did_read_res": [0x10, 0x0B, 0x62, 0xF1, 0x99],
        "data_length": 8,
    },
    "did_calib_con_version": {
        "id": 7,
        "text": "Calibration Consolidated Version",
        "did_index": 0xF101,
        "did_req": [[0x10, 0x0B, 0x2E, 0xF1, 0x01], [0x21, ]],
        "did_res": [0x03, 0x6E, 0xF1, 0x01, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x01, 0, 0, 0, 0],
        "did_read_res": [0x10, 0x0B, 0x62, 0xF1, 0x01],
        "data_length": 8,
    },
    "did_calib_checksum": {
        "id": 8,
        "text": "Calibration Checksum",
        "did_index": 0xF105,
        "did_req": [[0x05, 0x2E, 0xF1, 0x05]],
        "did_res": [0x03, 0x6E, 0xF1, 0x05, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x05, 0, 0, 0, 0],
        "did_read_res": [0x05, 0x62, 0xF1, 0x05],
        "data_length": 2,
    },
    "did_hex_file_name": {
        "id": 9,
        "text": "Hex File Name",
        "did_index": 0xF111,
        "did_req": [[0x10, 0x017, 0x2E, 0xF1, 0x11], [0x21, ], [0x22, ]],
        "did_res": [0x03, 0x6E, 0xF1, 0x11, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x11, 0, 0, 0, 0],
        "did_read_res": [0x10, 0x11, 0x62, 0xf1, 0x11],
        "data_length": 14,
    },
    "did_calib_id": {
        "id": 10,
        "text": "Calibration Id",
        "did_index": 0xF112,
        "did_req": [[0x10, 0x019, 0x2E, 0xF1, 0x12], [0x21, ], [0x22, ]],
        "did_res": [0x03, 0x6E, 0xF1, 0x12, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x12, 0, 0, 0, 0],
        "did_read_res": [0x10, 0x13, 0x62, 0xf1, 0x12],
        "data_length": 16,
    },
    "did_vendor_code": {
        "id": 11,
        "text": "Vendor Code",
        "did_index": 0xF192,
        "data_length": 8,
        "did_req": [[0x10, 0x0B, 0x2E, 0xF1, 0x92], [0x21, ]],
        "did_res": [0x03, 0x6E, 0xF1, 0x92, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x92, 0, 0, 0, 0],
        "did_read_res": [0x10, 0x0B, 0x62, 0xF1, 0x92],
    },
    "did_dealer_code": {
        "id": 12,
        "text": "Dealer Code",
        "did_index": 0xF198,
        "did_req": [[0x05, 0x2E, 0xF1, 0x98]],
        "did_res": [0x03, 0x6E, 0xF1, 0x98, 0, 0, 0, 0],
        "did_read_req": [0x03, 0x22, 0xF1, 0x98, 0, 0, 0, 0],
        "did_read_res": [0x05, 0x62, 0xF1, 0x98],
        "data_length": 2,
    }
}
# --####################################### DID ########################################

# --####################################### DTC ########################################
DTC_ID = 0x19

DTC_COUNT_RESPONSE = [0x06, 0x59, 0x01, 0xFF, 0x01]

DTC_SINGLE_ERROR_RESPONSE = [0x07, 0x59, 0x02, 0xFF]

DTC_START_BYTE_MULTI_ERROR = 0x10

DTC_MULTI_ERROR_RESPONSE_IDS = [0x21, 0x22, 0x23, 0x24, 0x25, 0x26]

DTC_WRITE_RESPONSE = [0x30, 0, 0, 0, 0, 0, 0, 0]

GET_DTC_ACTIVE_STATE = lambda val: "Current DTC " if val[0] == 1 else "In Active DTC"

DTC_ERROR_COUNT_REQUEST = [0x03, 0x19, 0x01, 0, 0, 0, 0, 0]

DTC_ERROR_REQUEST = [0x03, 0x19, 0x02, 0xFF, 0, 0, 0, 0]

DTC_ERROR_CODE_DICT = {
     "Over Voltage": [0x15, 0x45, 0x02],
     "Under Voltage":   [0x15, 0x45, 0x01],
     "Unregulated Battery Voltage":   [0x15, 0x48, 0x01],
     "Phase Interchange Fault":   [0x15, 0x46, 0x01],
     "Line Open Fault":   [0x15, 0x4C, 0x01],
     "Line Short Fault":   [0x15, 0x41, 0x01],
     "Unsafe ECU Temp Fault":   [0x15, 0x47, 0x01],
     "Unsafe Current Fault":   [0x15, 0x42, 0x01],
     "Machine Stall":   [0x20, 0x11, 0x00],
     "Hall Fault":   [0x20, 0x12, 0x00],
}


DTC_ACTIVE_STATE_DICT = {
     "01" : "Current",
     "10" : "Inactive",
     "00" : ""
}

DTC_STATE_PRIORITY_DICT = {
     "001" : "Priority 0",
     "010" : "Priority 1",
     "100" : "Priority 2",
     "000" : ""
}

DTC_STATE_GROUP_DICT = {
     "001" : "Group 0",
     "010" : "Group 1",
     "100" : "Group 2",
     "000" : ""
}

DTC_ERASE_REQUEST = [0x01, 0x14, 0, 0, 0, 0, 0, 0]
DTC_ERASE_RESPONSE = [1, 0x54, 0, 0, 0, 0, 0, 0]

# --####################################### DTC ########################################

